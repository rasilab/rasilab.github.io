<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Debug 404 Redirect</title>
    <script type="text/javascript">
      // Debug version to see what's happening
      var pathSegmentsToKeep = 1;
      var l = window.location;
      
      console.log('Current location:', l.href);
      console.log('Pathname:', l.pathname);
      console.log('Search:', l.search);
      console.log('Hash:', l.hash);
      console.log('pathSegmentsToKeep:', pathSegmentsToKeep);
      
      var pathArray = l.pathname.split('/');
      console.log('Path array:', pathArray);
      
      var newPath = pathArray.slice(0, 1 + pathSegmentsToKeep).join('/');
      console.log('New base path:', newPath);
      
      var redirectPath = l.pathname.slice(1).split('/').slice(pathSegmentsToKeep).join('/').replace(/&/g, '~and~');
      console.log('Redirect path:', redirectPath);
      
      var finalUrl = l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') +
        newPath + '/?/' +
        redirectPath +
        (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
        l.hash;
      
      console.log('Final redirect URL:', finalUrl);
      
      // Show the redirect info before actually redirecting
      document.body.innerHTML = '<h1>Debug 404 Redirect</h1>' +
        '<p><strong>Current URL:</strong> ' + l.href + '</p>' +
        '<p><strong>Would redirect to:</strong> ' + finalUrl + '</p>' +
        '<p><a href="' + finalUrl + '">Click to redirect manually</a></p>';
      
      // Uncomment to actually redirect:
      // l.replace(finalUrl);
    </script>
  </head>
  <body>
    <h1>Loading debug info...</h1>
  </body>
</html>