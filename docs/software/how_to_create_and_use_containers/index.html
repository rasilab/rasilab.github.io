
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation of lab policies and workflows">
      
      
        <meta name="author" content="rasilab">
      
      
        <link rel="canonical" href="https://rasilab.github.io/docs/software/how_to_create_and_use_containers/">
      
      
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>How to create and use containers - Subramaniam Lab Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DejaVu+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"DejaVu Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra_colors.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-use-singularity-containers-on-rhino-for-interactive-data-analysis-in-r-and-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Subramaniam Lab Docs" class="md-header__button md-logo" aria-label="Subramaniam Lab Docs" data-md-component="logo">
      
  <img src="../../images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Subramaniam Lab Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to create and use containers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rasilab/protocols_tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rasilab/protocols_tutorials
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Subramaniam Lab Docs" class="md-nav__button md-logo" aria-label="Subramaniam Lab Docs" data-md-component="logo">
      
  <img src="../../images/logo.svg" alt="logo">

    </a>
    Subramaniam Lab Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rasilab/protocols_tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rasilab/protocols_tutorials
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab_manual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Manual
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experiments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiments
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Analysis
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../writing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab_admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Admin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Everthing Else
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="http://rasilab.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Website
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-use-singularity-containers-on-rhino-for-interactive-data-analysis-in-r-and-python" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Singularity containers on rhino for interactive data analysis in R and Python
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to use Singularity containers on rhino for interactive data analysis in R and Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps-on-the-remote-machine-for-example-fred-hutch-rhino-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Steps on the remote machine (for example, Fred Hutch rhino cluster).
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-on-local-machine-for-example-your-lab-desktop-computer" class="md-nav__link">
    <span class="md-ellipsis">
      Steps on local machine (for example, your lab desktop computer)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-singularity-containers-in-snakemake-workflows-on-the-fred-hutch-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Singularity containers in Snakemake workflows on the Fred Hutch cluster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-organization-for-docker-and-singularity-images-in-the-lab" class="md-nav__link">
    <span class="md-ellipsis">
      General organization for Docker and Singularity images in the lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-build-and-tag-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to build and tag Docker images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-images-locally" class="md-nav__link">
    <span class="md-ellipsis">
      How to use images locally
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>How to create and use containers</h1>

<h2 id="how-to-use-singularity-containers-on-rhino-for-interactive-data-analysis-in-r-and-python">How to use Singularity containers on <code>rhino</code> for interactive data analysis in R and Python<a class="headerlink" href="#how-to-use-singularity-containers-on-rhino-for-interactive-data-analysis-in-r-and-python" title="Permanent link">&para;</a></h2>
<h3 id="steps-on-the-remote-machine-for-example-fred-hutch-rhino-cluster">Steps on the remote machine (for example, Fred Hutch <code>rhino</code> cluster).<a class="headerlink" href="#steps-on-the-remote-machine-for-example-fred-hutch-rhino-cluster" title="Permanent link">&para;</a></h3>
<ul>
<li>On a terminal, login into <code>rhino</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ssh<span class="w"> </span>rhino02
</code></pre></div>
<ul>
<li>
<p>Make sure that any <code>conda</code> initialization is commented out in your <code>.bashrc</code> or <code>.bash_profile</code> file on the remote machine. This step is <strong>important</strong>. Otherwise, VScode will not recognize the <code>conda</code> environments within the Singularity container.</p>
</li>
<li>
<p>Do the remote operations below from within a <a href="https://github.com/rasilab/r_python/tree/main#:~:text=from%20within%20a-,tmux,-session%20so%20that"><code>tmux</code></a> session so that you can detach and logout of your remote session and still keep the container running.</p>
</li>
<li>
<p>Start a tmux session:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>tmux<span class="w"> </span>new<span class="w"> </span>-s<span class="w"> </span>tunnel
</code></pre></div>
<ul>
<li>Make Singularity available:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>module<span class="w"> </span>load<span class="w"> </span>Singularity
</code></pre></div>
<ul>
<li>Go to the folder with our lab Singularity images and start the appropriate Singularity container:</li>
</ul>
<p>```bash
  cd /fh/working/subramaniam_a/singularity/
  singularity exec -B /fh r_python_1.3.0.sif /bin/bash</p>
<ul>
<li>Start a VScode CLI tunnel from within the container:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>./code<span class="w"> </span>tunnel<span class="w"> </span>--cli-data-dir<span class="o">=</span>/home/<span class="nv">$USER</span>/R_PYTHON<span class="w"> </span>
</code></pre></div>
<p>If you are doing the above the first time, you will have to login to GitHub using the displayed code and also name the tunnel.</p>
<ul>
<li>Give the tunnel the name of the container so that you can easily identify it later.</li>
<li>You can open new <code>tmux</code> panes within the same <code>tmux</code> session and run multiple different containers at the same time.</li>
</ul>
<h3 id="steps-on-local-machine-for-example-your-lab-desktop-computer">Steps on local machine (for example, your lab desktop computer)<a class="headerlink" href="#steps-on-local-machine-for-example-your-lab-desktop-computer" title="Permanent link">&para;</a></h3>
<ul>
<li>On VScode, open a remote window</li>
<li>Search for the command <code>Remote-Tunnels: Connect to Tunnel:</code>. Alternately, click on the bottom left-hand corner with <code>&gt;&lt;</code> symbol for <code>Open Remote Window</code></li>
<li>You might have to login to your <code>GitHub</code> account at this point.</li>
<li>Select the active tunnel that you started on <code>rhino</code>.</li>
<li>You can now open any folder on the remote machine and create a Jupyter notebook.</li>
<li>You should be able to pick the Python interpreter at <code>/opt/conda/bin/python</code> or the Jupyter R kernel at <code>/opt/conda/envs/R/lib/R/bin/R</code> to run your Python or R notebook.</li>
</ul>
<h2 id="how-to-use-singularity-containers-in-snakemake-workflows-on-the-fred-hutch-cluster">How to use Singularity containers in Snakemake workflows on the Fred Hutch cluster<a class="headerlink" href="#how-to-use-singularity-containers-in-snakemake-workflows-on-the-fred-hutch-cluster" title="Permanent link">&para;</a></h2>
<p>We often use our lab's <a href="https://github.com/orgs/rasilab/packages">standard</a> Docker containers for running specific Snakemake rules on the Fred Hutch cluster. 
If you use a specification of the form <code>singularity: "docker://ghcr.io/rasilab/r:1.0.0"</code> within a Snakemake rule, then this Docker container will be pulled to your local directory, converted to a Singularity container, and stored at <code>.snakemake/singularity</code> in your current working directory. 
However, it takes a long time to download and convert each Docker container and each container also uses up several GB of space. 
To avoid this, Rasi has stored a copy of all commonly used Singularity containers in our lab at <code>/fh/working/subramaniam_a/singularity</code>. You can symbolically link this folder to your workflow by executing the following from the folder that contains your Snakemake file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>mkdir .snakemake
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>cd .snakemake
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>ln -s /fh/working/subramaniam_a/singularity .
</code></pre></div>
<p>This will make all common singularity containers (files ending with <code>.simg</code>) immediately available to your Snakemake workflow. Note that Snakemake names the Singularity containers based on their SHA IDs.
If you can get the SHA IDs for any container by using the <code>hash_generatory.py</code> script located in the above folder. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>python3 hash_generator.py docker://ghcr.io/rasilab/r_python:1.3.0
</code></pre></div>
<h2 id="general-organization-for-docker-and-singularity-images-in-the-lab">General organization for Docker and Singularity images in the lab<a class="headerlink" href="#general-organization-for-docker-and-singularity-images-in-the-lab" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>All Docker image should be built off a <code>Dockerfile</code> file that lives in its own public GitHub repository in the <a href="https://github.com/orgs/rasilab/">rasilab</a> GitHub organization account. </p>
</li>
<li>
<p>All Docker images should be publicly available in our lab's GitHub <a href="https://github.com/orgs/rasilab/packages">container</a> repository.</p>
</li>
<li>
<p>For routine analyses and writing, use our lab's default <a href="https://github.com/rasilab/r/pkgs/container/r">R</a>, <a href="https://github.com/rasilab/python/pkgs/container/python">Python</a>, and <a href="https://github.com/rasilab/pandoc-latex/pkgs/container/pandoc-latex">Latex</a> images. These images contain commonly used libraries in our lab, as you can see in the <code>Dockerfile</code> of each image.</p>
</li>
<li>
<p>If you require additional R, Python, or Latex libraries not present in the above default images, build child images based off the above base images. For example, see the <a href="https://github.com/rasilab/r/pkgs/container/mageck">MaGeCK</a> package built off our default <a href="https://github.com/rasilab/pyhon/pkgs/container/python">Python</a> package.</p>
</li>
<li>
<p>If you need standalone bioinformatic packages, derive them off the <a href="https://hub.docker.com/layers/continuumio/miniconda3/4.12.0/images/sha256-58b1c7df8d69655ffec017ede784a075e3c2e9feff0fc50ef65300fc75aa45ae?context=explore">Miniconda3 4.12.0</a> base image. For example, see the <a href="https://github.com/rasilab/samtools/pkgs/container/samtools">Samtools</a> package in our lab's package repository. You can also use these images as basis for other packages. For example, see the <a href="https://github.com/rasilab/bowtie2/blob/main/Dockerfile">Bowtie2</a> package in our lab's package repository.</p>
</li>
<li>
<p>Note that <code>Docker</code> is not allowed on the Fred Hutch cluster. You can use <code>Singularity</code> images instead.</p>
</li>
</ul>
<h2 id="steps-to-build-and-tag-docker-images">Steps to build and tag Docker images<a class="headerlink" href="#steps-to-build-and-tag-docker-images" title="Permanent link">&para;</a></h2>
<p>To create or update a <code>Dockerfile</code> and the associated <code>image</code>, follow these steps:</p>
<ul>
<li>
<p>Edit the <code>Dockerfile</code> in <code>VScode</code> to add or remove software. Always make modifications at the end of the <code>Dockerfile</code> so that only few intermediate images need to be re-created. This decreases the space and time requirements for building and pushing the image. </p>
</li>
<li>
<p>If you are creating a new GitHub repository for a new package, use a Dockerfile and README template from a previous package GitHub repository, for eg. <a href="https://github.com/rasilab/r/pkgs/container/mageck">MaGeCK</a>. Make sure to set the repository name and description appropriately, and update its visibility to public.</p>
</li>
<li>
<p>Build the Docker image from the folder that contains the <code>Dockerfile</code>. Give a specific tag (see below for tag convention).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>&lt;image_name:tag&gt;<span class="w"> </span>.
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># example</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>ghcr.io/rasilab/mageck:0.5.9<span class="w"> </span>.
</code></pre></div>
</li>
<li>
<p>Assuming the above build command is successful, first commit and tag the <code>Dockerfile</code>.  You might have to set the remote if you created a new GitHub repository using <code>git remote set-url origin &lt;url&gt;</code>. GitHub will prompt you for this when you create </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>git<span class="w"> </span>add<span class="w"> </span>Dockerfile
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Update Dockerfile with &lt;software&gt;&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>&lt;tag&gt;<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Update Dockerfile with &lt;software&gt;&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>&lt;tag&gt;
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>git<span class="w"> </span>push<span class="w"> </span>--all
</code></pre></div>
</li>
<li>
<p>We use the same tag for the GitHub repository containing the <code>Dockerfile</code> and the corresponding <code>image</code>. Both tags follow the <a href="https://semver.org/">semantic versioning</a> convention. In practice, this means:</p>
<ol>
<li>
<p>Use tags of the form <code>X.Y.Z</code>. Start with <code>0</code> for <code>X</code> and <code>1</code> for <code>Y</code> and <code>0</code> for <code>Z</code>.</p>
</li>
<li>
<p>If your package is for a single software package (eg. MaGeCK), then use the same version tag as the software package version you are installing. For example, see our lab's <a href="https://github.com/rasilab/mageck/pkgs/container/mageck">MaGeCK</a> image.</p>
</li>
<li>
<p>If you fix an error in a Dockerfile/image that contains several different packages (eg. our lab's <a href="https://github.com/rasilab/python/pkgs/container/python">Python</a> image), increment the third digit <code>Z</code>.</p>
</li>
<li>
<p>If you add an extra package that will not break compatibility of the Docker image with previous versions, increment the second digit <code>Y</code>.</p>
</li>
<li>
<p>If you make any incompatible changes, increment the first digit <code>X</code> (avoid this as much as possible).</p>
</li>
</ol>
</li>
<li>
<p>Push the Docker image to the GitHub container registry. The first time you do this from a computer, you will have to set up a Personal Access Token (classic version) as explained <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-personal-access-token-classic">here</a>.  Make sure to give the <a href="https://docs.github.com/en/packages/learn-github-packages/about-permissions-for-github-packages#about-scopes-and-permissions-for-package-registries"><code>write:packages</code></a> permission when you create the token. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>docker<span class="w"> </span>push<span class="w"> </span>&lt;image_name:tag&gt;
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># example</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>docker<span class="w"> </span>push<span class="w"> </span>ghcr.io/rasilab/python:1.2.0
</code></pre></div>
- Make sure to make the GitHub package and repository public so that you and other lab members can access it from the Fred Hutch cluster.</p>
</li>
<li>
<p>You can pull these images as <code>Singularity</code> images using the following command (used on Fred Hutch cluster):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>module<span class="w"> </span>load<span class="w"> </span>Singularity
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>singularity<span class="w"> </span>pull<span class="w"> </span>docker://&lt;image_name:tag&gt;
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1"># example</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>singularity<span class="w"> </span>pull<span class="w"> </span>docker://ghcr.io/rasilab/r_python:1.3.0
</code></pre></div>
</li>
</ul>
<h2 id="how-to-use-images-locally">How to use images locally<a class="headerlink" href="#how-to-use-images-locally" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>You can pull images to your local machine by:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>docker<span class="w"> </span>pull<span class="w"> </span>docker://ghcr.io/rasilab/PACAGE_NAME:X.Y.Z
</code></pre></div>
</li>
<li>
<p>You can create a named container from the above image by:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>pandoc-latex<span class="w"> </span>-v<span class="w"> </span><span class="nv">$HOME</span>:<span class="nv">$HOME</span><span class="w"> </span>ghcr.io/rasilab/pandoc-latex:1.1.0
</code></pre></div>
</li>
<li>
<p>You can use the container to run a command. For example,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-w<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="w"> </span>pandoc-latex<span class="w"> </span>pandoc<span class="w"> </span>manuscript.md<span class="w"> </span>--citeproc<span class="w"> </span>--template<span class="o">=</span>template.tex<span class="w"> </span>--metadata-file<span class="o">=</span>pandoc-options.yaml<span class="w"> </span>--pdf-engine<span class="o">=</span>xelatex<span class="w"> </span>-o<span class="w"> </span>manuscript.pdf<span class="w"> </span>--filter<span class="o">=</span>pandoc-svg.py
</code></pre></div>
</li>
<li>
<p>You can also use the containers in a VSCode <code>.devcontainer.json</code> file (for eg. to run Jupyter Notebooks):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ghcr.io/rasilab/r:1.0.0&quot;</span><span class="p">,</span>
</code></pre></div>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["instant"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>